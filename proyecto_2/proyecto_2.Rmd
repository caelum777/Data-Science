---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---
> Sede San Carlos
\
> Matematica para Ciencia de los Datos
\
> Proyecto II
\
> Autor: Andres Gonzalez
\
> 2019

``` {r echo = FALSE, message = FALSE}
library(visdat)
library(corrr) 
library(corrplot)
library(FactoMineR)
library(ggplot2)
library(factoextra)
```

<hr>

### I Parte

**1.** Se le pidió a un grupo de 100 clientes que compraron el mismo producto o productos similares en la tienda de AMAZON, que evaluaran el servicio recibido desde diferentes aspectos. El archivo EjemploAlgoritmosRecomendacion.csv muestra los promedios de la evaluación dada por los clientes en relación a las variables que se pueden apreciar en el encabezado de la tabla. Para este dataset, realice lo siguiente:

|        **a)** Cargue el dataset EjemploAlgoritmosRecomendacion.csv, verifique que la lectura de los datos es correcta.

\

```{r}
algoritmos <- read.csv("datos/EjemploAlgoritmosRecomendacion.csv", sep = ";", dec = ",", header = T,row.names = 1)
head(algoritmos)
```

\

|        **b)** A manera de diagnóstico, haga una inspección de los datos presentes en el dataset y describa las variables presentes, tipos de variables, si hay datos nulos.

\

```{r}
vis_dat(algoritmos)
```

\

|        **c)** Determine si existen correlaciones importantes entre las variables del dataset, utilizando alguno de los gráficos o la matriz de correlaciones vistos en clases (si desea, puede usar otra herramienta de su preferencia). Recordemos que para aplicar un ACP, es importante que existan correlaciones entre las variables.

\

```{r}
correlaciones <- round(cor(algoritmos), 2)
corrplot::corrplot(correlaciones)
```

\

|        **d)** Realice un ACP usando el paquete FactoMiner, creando el plano principal y el círculo de correlaciones. Superponga ambos gráficos e identifique la cantidad de clústeres que considere apropiado. Haga un análisis descriptivo de cada clúster, indique si hay variables correlacionadas y el tipo de correlación entre estas.

\

```{r}
pca_alg <- PCA(algoritmos, scale.unit=TRUE, ncp=5, graph = FALSE)
plot(pca_alg, axes=c(1, 2), choix="ind", col.ind="red", new.plot=TRUE)
plot(pca_alg, axes=c(1, 2), choix="var", col.var="blue",new.plot=TRUE)
```

\

|        **e)** Repita el ejercicio anterior usando el paquete FactoMineR, elimine de los gráficos los individuos con $cos^2(\Theta)\le0.2$ y las variables $cos^2(\Theta)\le0.55$ y vuelva a crear el plano principal y el círculo de correlaciones. ¿Cuáles individuos quedaron mal representados?, ¿cuáles variables quedaron mal representadas?

```{r}
cos2.ind<-(pca_alg$ind$cos2[,1] + pca_alg$ind$cos2[,2])
cos2.var<-(pca_alg$var$cos2[,1] + pca_alg$var$cos2[,2])

indmalrep <- NULL
varmalrep <- NULL

for (i in 1 : nrow(algoritmos)) {
  header <- names(cos2.ind[i])[1]
  value <- cos2.ind[i]
 ifelse(value <= 0.2, indmalrep <- cbind(matrix(c(header, value), 2, 1, TRUE), indmalrep), NA)
}

for (i in 1 : ncol(algoritmos)) {
  header <- names(cos2.var[i])[1]
  value <- cos2.var[i]
 ifelse(value <= 0.55, varmalrep <- cbind(matrix(c(header, value), 2, 1, TRUE), varmalrep), NA)
}

indmalrep
varmalrep

plot(pca_alg, axes=c(1, 2), choix="ind", col.ind="red", new.plot=TRUE, select="cos2 0.2")
plot(pca_alg, axes=c(1, 2), choix="var", col.var="blue",new.plot=TRUE, select="cos2 0.55")
```

```{r}
PCA <- prcomp(algoritmos, scale = TRUE)

pca_alg.hcpc <- HCPC(pca_alg, nb.clust=-1, min=2, max=3)
plot(pca_alg.hcpc, axes = 3:4)

fviz_pca_ind(PCA,
             col.ind = "cos2", # Color by the quality of representation
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = FALSE     # Avoid text overlapping
             )

fviz_pca_var(PCA,
             col.var = "cos2", # Color by the quality of representation
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = FALSE     # Avoid text overlapping
             )

fviz_pca_biplot(PCA, repel = FALSE,
                col.var = "#2E9FDF", # Variables color
                col.ind = "#696969"  # Individuals color
                )
```

